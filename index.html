<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Edebiyat Çarkı — Basit, Türkçe ve Responsive</title>

  <style>
    /* Basit reset ve değişkenler */
    :root{
      --arka: #0b1220;        /* Gece teması koyu arka plan */
      --metin: #e8eefc;       /* Açık metin rengi */
      --ikincil: #9bb4ff;     /* İkincil vurgu */
      --vurgulu: #52e3c2;     /* Buton/aktivite vurgusu */
      --tekerlek-boyut: clamp(260px, 70vmin, 540px); /* Çark çapı, ekrana göre */
      --kabin-boyut: clamp(28px, 6vmin, 46px);       /* Kabin kutusu */
      --panel-genislik: min(520px, 92vw);            /* Sağ panel max genişlik */
      --radius-ic: calc(var(--tekerlek-boyut)/2 - var(--kabin-boyut) - 10px); /* Kabinlerin merkezden uzaklığı */
      --adim: 30deg;           /* 360/12 = 30 derece */
      --golge: 0 6px 24px rgba(0,0,0,0.35);
      --kutu: #121a2b;
      --kutu-kenar: #223050;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 20% 10%, #0f1a33, #091121 55%, #050a14);
      color: var(--metin);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Sayfa başlığı */
    header{
      padding: 18px 16px;
      border-bottom: 1px solid #1b2745;
      background: linear-gradient(to bottom, rgba(255,255,255,0.02), rgba(255,255,255,0));
    }
    header h1{
      margin:0;
      font-size: clamp(18px, 3.6vw, 24px);
      letter-spacing: 0.3px;
    }
    header p{
      margin: 6px 0 0 0;
      color: #b9c7ef;
      font-size: 14px;
    }

    /* Ana düzen: geniş ekranda iki sütun, mobilde tek sütun */
    .sayfa{
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
    }
    @media (min-width: 980px){
      .sayfa{
        grid-template-columns: 1fr var(--panel-genislik);
        align-items: start;
      }
    }

    /* Sol: Çark kartı */
    .kart{
      background: var(--kutu);
      border: 1px solid var(--kutu-kenar);
      border-radius: 14px;
      box-shadow: var(--golge);
      padding: 14px;
    }
    .kart-baslik{
      display:flex; align-items:center; justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .kart-baslik h2{
      margin:0;
      font-size: 18px;
    }
    .ipucu{
      color:#b6c3e8;
      font-size:13px;
    }

    /* Çark alanı */
    .cark-kapsayici{
      display: grid;
      place-items: center;
      padding: 8px;
    }
    .cark{
      position: relative;
      width: var(--tekerlek-boyut);
      height: var(--tekerlek-boyut);
      border: 3px dashed #3a4f84;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(82,227,194,0.06), rgba(0,0,0,0)),
        radial-gradient(circle at 20% 30%, rgba(155,180,255,0.08), rgba(0,0,0,0));
      transition: filter 200ms ease;
      user-select: none;
      touch-action: none;
      overflow: visible; /* kabin gölgeleri taşınca */
    }
    .cark-merkez{
      position:absolute;
      inset: 50% auto auto 50%;
      width: clamp(26px, 5.5vmin, 40px);
      height: clamp(26px, 5.5vmin, 40px);
      background: conic-gradient(from 0deg, #53e3c2, #9bb4ff, #53e3c2);
      border: 3px solid #0d1526;
      border-radius: 50%;
      transform: translate(-50%,-50%);
      box-shadow: 0 0 0 3px #203054, 0 6px 24px rgba(0,0,0,0.45);
    }

    /* Her bir kabin (12 adet) */
    .kabin{
      position: absolute;
      top: 50%;
      left: 50%;
      width: var(--kabin-boyut);
      height: var(--kabin-boyut);
      transform-origin: center calc(-1 * var(--radius-ic)); /* dönerken merkeze bağlı kalsın */
      display: grid;
      place-items:center;
      color: #0b1220;
      font-weight: 700;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.35);
      border: 2px solid rgba(255,255,255,0.65);
      background: #ffd86b; /* varsayılan, JS ile renk dağıtacağız */
      transition: transform 120ms ease, background 200ms ease, scale 200ms ease;
    }
    .kabin .numara{ font-size: clamp(12px, 2.8vmin, 16px); }
    .kabin.secili{
      background: #52e3c2 !important;
      border-color: white;
      scale: 1.08;
      z-index: 2;
    }

    /* Üstte sabit bir işaretçi (seçimi gösterir) */
    .isaretci{
      position:absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 16px solid #ffd86b;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.35));
    }

    /* Kontroller (buton, dosya yükleme, ayarlar) */
    .kontroller{
      display: grid;
      gap: 10px;
      margin-top: 8px;
    }
    .satir{
      display:flex;
      flex-wrap: wrap;
      align-items:center;
      gap: 10px;
    }

    button, .buton{
      background: linear-gradient(180deg, #52e3c2, #32b79a);
      color: #07241d;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      transition: transform 80ms ease;
    }
    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(0); }

    .ikaz{
      color: #ffcd7a;
      font-size: 13px;
    }

    input[type="file"]{
      appearance:none;
      background:#0f1a2a;
      border:1px solid #2a3b63;
      color:#dfe8ff;
      border-radius:10px;
      padding:10px;
      max-width: 100%;
    }

    input[type="range"]{
      width: 200px;
    }

    /* Sağ: Sonuç kartı */
    .sonuc-karti{
      background: var(--kutu);
      border: 1px solid var(--kutu-kenar);
      border-radius: 14px;
      padding: 14px;
      box-shadow: var(--golge);
    }
    .sonuc-karti h3{ margin: 8px 0 6px 0; }
    .etiket{
      display: inline-block;
      background: #203054;
      border: 1px solid #37508b;
      color:#cfe1ff;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      margin-right: 6px;
    }
    .bos{
      color:#9fb0dc;
      font-style: italic;
      margin: 8px 0;
    }

    /* Alt bilgi: nasıl kullanılır */
    .alt-bilgi{
      margin-top: 12px;
      color: #b6c3e8;
      font-size: 13px;
    }

    /* Responsive düzen iyileştirmeleri */
    @media (max-width: 979px){
      .sonuc-karti{ order: 2; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Edebiyat Çarkı — Basitleştirilmiş Sürüm</h1>
    <p>Basılı tutup çarkı hızlandırın, bırakınca yavaşlayıp dursun. JSON dosyasıyla kendi eserlerinizi yükleyin.</p>
  </header>

  <main class="sayfa" aria-live="polite">
    <!-- SOL: ÇARK ve KONTROLLER -->
    <section class="kart" aria-label="Edebiyat Çarkı">
      <div class="kart-baslik">
        <h2>Çark</h2>
        <span class="ipucu">12 kabin • Seçim işaretçisi yukarıda</span>
      </div>

      <div class="cark-kapsayici">
        <div class="cark" id="cark" aria-label="Edebiyat çarkı">
          <!-- Seçimi gösteren işaretçi -->
          <div class="isaretci" aria-hidden="true"></div>
          <!-- Merkez göbek -->
          <div class="cark-merkez" aria-hidden="true"></div>
          <!-- Kabinler JS ile eklenecek -->
        </div>
      </div>

      <!-- Kontrol Alanı -->
      <div class="kontroller">
        <div class="satir">
          <button id="cevirButon" aria-pressed="false" aria-label="Basılı tutarak çevir">
            Basılı Tut → Döndür
          </button>
          <span id="durumYazi" class="ikaz">Hazır</span>
        </div>

        <div class="satir">
          <label for="yavaslama" title="Bıraktıktan sonra kaç saniyede dursun?">
            Yavaşlama Süresi: <strong><span id="yavaslamaDeger">3</span>s</strong>
          </label>
          <input id="yavaslama" type="range" min="1" max="6" step="0.5" value="3" />
        </div>

        <div class="satir">
          <input id="jsonInput" type="file" accept="application/json" aria-label="JSON dosyası yükle" />
          <button id="ornekIndirButon" class="buton" type="button">Örnek JSON indir</button>
        </div>
        <div id="jsonHata" class="ikaz" role="status" aria-live="polite"></div>
      </div>

      <div class="alt-bilgi">
        İpucu: JSON dosyası bir dizi nesneden oluşmalı. Örnek şema:
        [
          { "Başlık":"...", "Tür":"Kitap/Şiir/Metin", "Yazar":"...", "Metin":"..." }
        ]
      </div>
    </section>

    <!-- SAĞ: SONUÇ KARTI -->
    <aside class="sonuc-karti" aria-label="Seçilen Eser">
      <h2>Seçilen Eser</h2>
      <div id="sonucIcerik">
        <p class="bos">Çark durunca, seçilen eser burada görünecek.</p>
      </div>
    </aside>
  </main>

  <script>
    /*
      ================ GENEL AKIŞ ================
      - Sayfa yüklenince 12 kabini oluşturur ve daire etrafına dizer.
      - "Basılı Tut → Döndür" butonuna basınca açısal hız artar (ivme).
      - Bırakınca seçilen "yavaşlama süresi" içinde hız sıfıra iner.
      - Çark durduğunda yukarıdaki işaretçinin hizasındaki kabin "seçilmiş" olur.
      - Seçilen kabin -> eser dizisindeki bir ögeye denk gelir ve sağdaki kart doldurulur.
      - Kullanıcı JSON dosyası yüklerse "eserler" verisi güncellenir.
    */

    // ============ SABİTLER ============
    const KABIN_SAYISI = 12;                  // Toplam kabin
    const ADIM_ACISI = 360 / KABIN_SAYISI;    // 30 derece
    const MAKS_HIZ = 540;                     // derece/saniye cinsinden teorik tavan
    const IVME = 420;                         // derece/saniye^2 (basılı tutarken hız artışı)
    const RENGELER = [
      "#ffd86b", "#ff9b6b", "#ff6bb0", "#c26bff",
      "#6bb3ff", "#6bffdd", "#a4ff6b", "#ffe36b",
      "#ff886b", "#ff6bdf", "#8f6bff", "#6be2ff"
    ];

    // ============ DURUM DEĞİŞKENLERİ ============
    let acisalKonum = 0;          // Çarkın o anki döndürülme açısı (derece)
    let acisalHiz = 0;            // Çarkın açısal hızı (derece/saniye)
    let basiliMi = false;         // Buton basılı mı?
    let durmaModu = false;        // Bırakıldı ve yavaşlama aşamasında mıyız?
    let yavaslamaSuresi = 3;      // Bırakınca şu kadar saniyede dursun
    let yavaslamaBaslangicHizi = 0;
    let yavaslamaBaslangicZamani = 0;

    // Eser verisi (varsayılan). Kullanıcı JSON yükleyince güncellenir.
    let eserler = [
      { "Başlık": "Örnek Eser 1", "Tür": "Kitap", "Yazar": "Anonim", "Metin": "Bu bir örnek açıklamadır." },
      { "Başlık": "Örnek Eser 2", "Tür": "Şiir",  "Yazar": "Anonim", "Metin": "Şiirsel bir açıklama." },
      { "Başlık": "Örnek Eser 3", "Tür": "Metin", "Yazar": "Anonim", "Metin": "Kısa bir tanım." },
      { "Başlık": "Örnek Eser 4", "Tür": "Kitap", "Yazar": "Anonim", "Metin": "Başka bir örnek eser." },
      { "Başlık": "Örnek Eser 5", "Tür": "Şiir",  "Yazar": "Anonim", "Metin": "Dizeler..." },
      { "Başlık": "Örnek Eser 6", "Tür": "Metin", "Yazar": "Anonim", "Metin": "Açıklama burada." },
    ];

    // ============ ELEMANLAR ============
    const carkEl = document.getElementById('cark');
    const cevirButon = document.getElementById('cevirButon');
    const durumYazi = document.getElementById('durumYazi');
    const yavaslamaGirdi = document.getElementById('yavaslama');
    const yavaslamaDeger = document.getElementById('yavaslamaDeger');
    const jsonInput = document.getElementById('jsonInput');
    const jsonHata = document.getElementById('jsonHata');
    const sonucIcerik = document.getElementById('sonucIcerik');
    const ornekIndirButon = document.getElementById('ornekIndirButon');

    // ============ KABİNLERİ OLUŞTUR ============
    function kabinleriOlustur(){
      // Önce varsa eski kabinleri sil
      [...carkEl.querySelectorAll('.kabin')].forEach(n => n.remove());

      for(let i=0; i<KABIN_SAYISI; i++){
        const k = document.createElement('div');
        k.className = 'kabin';
        k.setAttribute('role', 'img');
        k.setAttribute('aria-label', `Kabin ${i+1}`);
        // Renk dağıt
        k.style.background = RENGELER[i % RENGELER.length];
        // Kabini daire etrafına yerleştirmek için başlangıç dönüşünü veriyoruz,
        // asıl çark dönüşü .cark üzerine uygulanacak.
        const aci = i * ADIM_ACISI; // 0,30,60,...,330
        k.style.transform = `translate(-50%,-50%) rotate(${aci}deg)`;
        // İç numara
        const span = document.createElement('span');
        span.className = 'numara';
        span.textContent = i+1;
        k.appendChild(span);
        carkEl.appendChild(k);
      }
    }

    // ============ SEÇİM HESABI ============
    function secilenKabinIndex(){
      // Çark dönüş açısı acisalKonum (derece). Yukarı işaretçide olan kabini bulmak için:
      // Yakın olan açıyı bulmak: round((360 - acisalKonum) / 30) mod 12
      const norm = ((360 - (acisalKonum % 360)) + 360) % 360;
      const idx = Math.round(norm / ADIM_ACISI) % KABIN_SAYISI;
      return idx;
    }

    function secimVurgulaVeGoster(){
      const tumKabinler = [...carkEl.querySelectorAll('.kabin')];
      tumKabinler.forEach(k => k.classList.remove('secili'));
      const idx = secilenKabinIndex();
      if(tumKabinler[idx]) tumKabinler[idx].classList.add('secili');

      // Eser eşleştirme: kabin indexine göre bir eseri seç
      const eser = eserler.length ? eserler[idx % eserler.length] : null;
      if(eser){
        sonucIcerik.innerHTML = `
          <div>
            <span class="etiket">${eser.Tür || 'Tür'}</span>
            <span class="etiket">${eser.Yazar || 'Yazar'}</span>
          </div>
          <h3>${eser.Başlık || 'Başlık yok'}</h3>
          <p>${eser.Metin || 'Açıklama bulunamadı.'}</p>
        `;
      }else{
        sonucIcerik.innerHTML = `<p class="bos">Eser verisi bulunamadı.</p>`;
      }
    }

    // ============ ANİMASYON DÖNGÜSÜ ============
    let oncekiZaman = performance.now();
    function dongu(simdi = performance.now()){
      const dt = Math.min(0.05, (simdi - oncekiZaman)/1000); // saniye cinsinden, 50ms tavan
      oncekiZaman = simdi;

      if(basiliMi){
        // Basılı tutarken hız, IVME kadar artar (MAKS_HIZ tavanı var)
        acisalHiz = Math.min(MAKS_HIZ, acisalHiz + IVME * dt);
      }else if(durmaModu){
        // Bıraktıktan sonra ease-out ile sıfıra düşür
        const gecen = (simdi - yavaslamaBaslangicZamani) / 1000;
        const t = Math.max(0, Math.min(1, gecen / yavaslamaSuresi)); // 0..1
        const easeOutCubic = (x)=> 1 - Math.pow(1 - x, 3);
        const carpan = 1 - easeOutCubic(t);
        acisalHiz = yavaslamaBaslangicHizi * carpan;
        if(t >= 1){
          acisalHiz = 0;
          durmaModu = false;
          durumYazi.textContent = 'Durdu';
          secimVurgulaVeGoster();
        }
      }else{
        // Ne basılı ne durma modunda: sürtünme gibi hafif azalım (gerekirse)
        acisalHiz *= 0.995;
        if(Math.abs(acisalHiz) < 0.02) acisalHiz = 0;
      }

      // Açıyı güncelle ve uygula
      acisalKonum = (acisalKonum + acisalHiz * dt) % 360;
      carkEl.style.transform = `rotate(${acisalKonum}deg)`;

      requestAnimationFrame(dongu);
    }

    // ============ ETKİLEŞİM ============
    function basmayaBasla(e){
      e.preventDefault();
      basiliMi = true;
      durmaModu = false;
      cevirButon.setAttribute('aria-pressed', 'true');
      durumYazi.textContent = 'Hızlanıyor...';
    }
    function birak(e){
      if(!basiliMi) return;
      basiliMi = false;
      cevirButon.setAttribute('aria-pressed', 'false');
      // Şimdi yavaşlamaya geç
      durmaModu = true;
      yavaslamaBaslangicHizi = Math.max(60, acisalHiz); // çok düşükse bile 60'dan başlat ki hissedilsin
      yavaslamaBaslangicZamani = performance.now();
      durumYazi.textContent = 'Yavaşlıyor...';
    }

    // Fare
    cevirButon.addEventListener('mousedown', basmayaBasla);
    document.addEventListener('mouseup', birak);
    cevirButon.addEventListener('mouseleave', (e)=>{ if(basiliMi) birak(e); });

    // Dokunmatik
    cevirButon.addEventListener('touchstart', basmayaBasla, {passive: true});
    cevirButon.addEventListener('touchend', birak);
    cevirButon.addEventListener('touchcancel', birak);

    // Yavaşlama süresi kontrolü
    yavaslamaGirdi.addEventListener('input', ()=>{
      yavaslamaSuresi = Number(yavaslamaGirdi.value);
      yavaslamaDeger.textContent = yavaslamaSuresi;
    });

    // JSON yükleme (dosya)
    jsonInput.addEventListener('change', async ()=>{
      jsonHata.textContent = '';
      const f = jsonInput.files?.[0];
      if(!f) return;
      try{
        const text = await f.text();
        const data = JSON.parse(text);
        if(!Array.isArray(data)) throw new Error('JSON bir dizi olmalı.');
        // Basit doğrulama
        const temiz = data.map((x,i)=>({
          "Başlık": x["Başlık"] ?? `Eser ${i+1}`,
          "Tür":    x["Tür"]    ?? "Metin",
          "Yazar":  x["Yazar"]  ?? "Bilinmiyor",
          "Metin":  x["Metin"]  ?? ""
        }));
        if(temiz.length === 0) throw new Error('JSON dizisi boş.');
        eserler = temiz;
        jsonHata.textContent = `✅ ${eserler.length} eser yüklendi.`;
      }catch(err){
        jsonHata.textContent = '⚠️ JSON okunamadı: ' + (err?.message || err);
      }
    });

    // Örnek JSON indir butonu (kullanıcıya yerel bir örnek ver)
    ornekIndirButon.addEventListener('click', ()=>{
      const ornek = [
        { "Başlık": "Küçük Prens", "Tür": "Kitap", "Yazar": "Antoine de Saint-Exupéry", "Metin": "Dostluk ve hayal gücü üzerine modern bir klasik." },
        { "Başlık": "Sessiz Gemi", "Tür": "Şiir", "Yazar": "Yahya Kemal Beyatlı", "Metin": "Ölüm ve ayrılık temalı unutulmaz dizeler." },
        { "Başlık": "Sait Faik Öyküsü", "Tür": "Metin", "Yazar": "Sait Faik Abasıyanık", "Metin": "Gözlem gücü yüksek, insanı anlatan yalın bir dil." }
      ];
      const blob = new Blob([JSON.stringify(ornek, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ornek_eserler.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    // ============ BAŞLAT ============
    kabinleriOlustur();
    requestAnimationFrame(dongu);

    // Not: Pencere boyutu değişse de bu sürümde kabin yerleşimi transform ile yapıldığı için
    // özel bir yeniden hesaplama gerekmez. (Çap varsayılan olarak vmin tabanlı olduğu için responsive.)
  </script>
</body>
</html>